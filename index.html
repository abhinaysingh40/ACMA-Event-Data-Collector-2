<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Data Collector</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        :root { --uno-blue: #003366; --warn: #e31e24; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
        
        /* HEADER & LOGO */
        .header-bar { background: white; padding: 15px; text-align: center; border-bottom: 3px solid var(--uno-blue); }
        .logo { max-height: 80px; margin-bottom: 10px; }
        h1 { margin: 0; color: var(--uno-blue); font-size: 24px; text-transform: uppercase; }

        .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 15px; box-shadow: 0 8px 30px rgba(0,0,0,0.15); overflow: hidden; }
        .tabs { display: flex; background: #eee; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; cursor: pointer; font-weight: bold; color: #666; }
        .tab-btn.active { background: white; color: var(--uno-blue); border-top: 4px solid var(--uno-blue); }
        
        .content { padding: 25px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 13px; font-weight: 700; margin-bottom: 5px; color: #444; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        
        /* ADMIN UI */
        .admin-action { background: #fff5f5; border: 1px solid var(--warn); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .btn-del { background: var(--warn); color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; float: right; }
        .btn-submit { width: 100%; padding: 16px; background: var(--uno-blue); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        .hidden { display: none; }
        hr { border: 0; border-top: 1px solid #eee; margin: 20px 0; }
    </style>
</head>
<body>

<div class="header-bar">
    <img src="logo.png" alt="Uno Minda Logo" class="logo">
    <h1>Event Data Collector</h1>
</div>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('visitor')">Visitor Form</button>
        <button class="tab-btn" onclick="switchTab('admin')">Admin (Activity)</button>
    </div>

    <div class="content">
        <div id="visitor-ui">
            <form id="masterForm">
                <input type="hidden" name="auth_token" value="UnoMinda_ACMA_2026_Secure_Handshake">
                
                <div class="form-group">
                    <label>Your Name (Employee Name)*</label>
                    <input type="text" name="Filled By (Employee Name)" placeholder="Enter your full name" required>
                </div>
                
                <hr>

                <div class="form-group">
                    <label>Activity Category*</label>
                    <select name="Activity" id="activitySelect" required>
                        <option value="">-- Select Activity --</option>
                        <option value="Stall Design" data-budget="500000">Stall Design (Budget: 5L)</option>
                        <option value="Catering" data-budget="200000">Catering (Budget: 2L)</option>
                    </select>
                </div>

                <div class="form-group"><label>Vendor Name*</label><input type="text" name="VendorName" required></div>
                <div class="form-group"><label>Proposed Cost (INR)*</label><input type="number" name="Cost" id="costInput" required></div>
                
                <hr>
                
                <div id="dynamic-fields">
                    <div class="form-group"><label>Contact Person*</label><input type="text" name="FirstName" required></div>
                    <div class="form-group"><label>Email ID*</label><input type="email" name="Email" required></div>
                </div>

                <button type="submit" class="btn-submit" id="submitBtn">Submit & Validate Budget</button>
            </form>
        </div>

        <div id="admin-ui" class="hidden">
            <h3>Manage Activities</h3>
            <div id="activity-list">
                <div class="admin-action">
                    <span><strong>Stall Design</strong> (Approved: 5,00,000)</span>
                    <button class="btn-del" onclick="confirmDelete('Stall Design')">Delete Activity</button>
                </div>
            </div>
            <button class="btn-submit" style="background:#444;" onclick="alert('Open Google Sheet to add more rows')">View Reports</button>
        </div>
    </div>
</div>

<script>
    const G_URL = 'https://script.google.com/macros/s/AKfycbzZ05CJvaAYeAAAnT-QOaodveGggnEaRVXSQA2Xo4043C44Ny7wKpHzcU5UkkFGYMaZPw/exec';

    function switchTab(mode) {
        document.getElementById('visitor-ui').classList.toggle('hidden', mode === 'admin');
        document.getElementById('admin-ui').classList.toggle('hidden', mode === 'visitor');
        document.querySelectorAll('.tab-btn').forEach((b,i) => b.classList.toggle('active', (i===0 && mode==='visitor') || (i===1 && mode==='admin')));
    }

    // BUDGET VALIDATION
    document.getElementById('masterForm').onsubmit = function(e) {
        e.preventDefault();
        
        const costInput = document.getElementById('costInput').value;
        const cost = parseFloat(costInput);
        const selected = document.getElementById('activitySelect').selectedOptions[0];
        
        if (!selected.value) {
            alert("Please select an Activity Category.");
            return;
        }

        const budget = parseFloat(selected.getAttribute('data-budget'));

        if (cost > budget) {
            alert("⚠️ WARNING: This vendor cost (" + cost.toLocaleString() + ") exceeds the Activity Budget (" + budget.toLocaleString() + ")!");
            return;
        }

        const btn = document.getElementById('submitBtn');
        btn.disabled = true; btn.innerText = "Processing...";

        fetch(G_URL, { method: 'POST', body: new FormData(this) })
        .then(r => r.text())
        .then(txt => {
            alert("Success! Data submitted.");
            location.reload();
        }).catch(() => { alert("Error connecting to server!"); btn.disabled = false; btn.innerText = "Submit & Validate Budget"; });
    };

    // DELETE WARNING
    function confirmDelete(name) {
        const warn = confirm("Are you sure you want to delete '" + name + "'?\n\nWARNING: If data has been entered by team members under this activity, it may be orphaned or lost!");
        if (warn) {
            const fd = new FormData();
            fd.append("auth_token", "UnoMinda_ACMA_2026_Secure_Handshake");
            fd.append("action", "deleteActivity");
            fd.append("activityName", name);
            
            fetch(G_URL, { method: 'POST', body: fd })
            .then(r => r.text())
            .then(t => { alert(t); location.reload(); });
        }
    }
</script>
</body>
</html>
